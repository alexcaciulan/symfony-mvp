{{ form_start(form) }}

<div class="space-y-6">
    {# Type selector (PF/PJ) #}
    <div data-controller="conditional-fields" data-conditional-fields-show-value="pj">
        <div class="mb-4">
            <span class="block text-sm font-medium text-gray-700 mb-2">{{ 'wizard.step2.type'|trans }}</span>
            <div class="flex gap-4">
                {% for child in form.type %}
                    <label class="flex items-center gap-2 cursor-pointer">
                        {{ form_widget(child, { attr: {
                            class: 'text-primary-light focus:ring-primary-light',
                            'data-conditional-fields-target': loop.first ? 'source' : '',
                            'data-action': 'change->conditional-fields#toggle',
                        }}) }}
                        <span class="text-sm text-gray-700">{{ child.vars.label|trans }}</span>
                    </label>
                {% endfor %}
            </div>
            {{ form_errors(form.type) }}
        </div>

        {# Common fields #}
        <div class="space-y-4">
            <div>
                {{ form_label(form.name, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.name, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                {{ form_errors(form.name) }}
            </div>

            {# PF fields (inverse = shown when NOT pj) #}
            <div data-conditional-fields-target="inverse">
                {{ form_label(form.cnp, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.cnp, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                {{ form_errors(form.cnp) }}
            </div>

            {# PJ fields (conditional = shown when pj) #}
            <div data-conditional-fields-target="conditional" class="space-y-4">
                <div>
                    {{ form_label(form.cui, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                    {{ form_widget(form.cui, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                    {{ form_errors(form.cui) }}
                </div>
                <div>
                    {{ form_label(form.companyName, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                    {{ form_widget(form.companyName, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                    {{ form_errors(form.companyName) }}
                </div>
            </div>
        </div>
    </div>

    {# Contact #}
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
            {{ form_label(form.email, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
            {{ form_widget(form.email, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            {{ form_errors(form.email) }}
        </div>
        <div>
            {{ form_label(form.phone, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
            {{ form_widget(form.phone, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            {{ form_errors(form.phone) }}
        </div>
    </div>

    {# Address #}
    <fieldset class="border border-gray-200 rounded-lg p-4">
        <legend class="text-sm font-medium text-gray-700 px-2">{{ 'wizard.step2.address'|trans }}</legend>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
                {{ form_label(form.street, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.street, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.streetNumber, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.streetNumber, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.block, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.block, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.staircase, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.staircase, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.apartment, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.apartment, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.city, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.city, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.county, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.county, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
            <div>
                {{ form_label(form.postalCode, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                {{ form_widget(form.postalCode, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
            </div>
        </div>
    </fieldset>

    {# Lawyer section #}
    <div data-controller="conditional-fields" data-conditional-fields-show-value="checked">
        <div class="flex items-center gap-2">
            {{ form_widget(form.hasLawyer, { attr: {
                class: 'rounded text-primary-light focus:ring-primary-light',
                'data-conditional-fields-target': 'source',
                'data-action': 'change->conditional-fields#toggle',
            }}) }}
            {{ form_label(form.hasLawyer, null, { label_attr: { class: 'text-sm font-medium text-gray-700' }}) }}
        </div>

        <div data-conditional-fields-target="conditional" class="mt-4 space-y-4 pl-6 border-l-2 border-primary-light">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    {{ form_label(form.lawyerName, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                    {{ form_widget(form.lawyerName, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                    {{ form_errors(form.lawyerName) }}
                </div>
                <div>
                    {{ form_label(form.lawyerBarNumber, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                    {{ form_widget(form.lawyerBarNumber, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                </div>
                <div>
                    {{ form_label(form.lawyerPhone, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                    {{ form_widget(form.lawyerPhone, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                </div>
                <div>
                    {{ form_label(form.lawyerEmail, null, { label_attr: { class: 'block text-sm font-medium text-gray-700 mb-1' }}) }}
                    {{ form_widget(form.lawyerEmail, { attr: { class: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-light' }}) }}
                </div>
            </div>
        </div>
    </div>
</div>

{# Actions #}
<div class="flex justify-between mt-8">
    <a href="{{ path('case_step', { id: legalCase.id, step: step - 1 }) }}" class="px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors no-underline">
        {{ 'wizard.previous'|trans }}
    </a>
    <button type="submit" class="px-6 py-2.5 bg-primary-light text-white rounded-lg font-medium hover:bg-primary transition-colors">
        {{ 'wizard.next'|trans }}
    </button>
</div>

{{ form_end(form) }}
